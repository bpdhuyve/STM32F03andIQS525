//================================================================================================//
// M O D U L E   H E A D E R
//------------------------------------------------------------------------------------------------//
// easy access methods for the TimeStamp module
//
// Copyright (c), PsiControl Mechatronics NV, All rights reserved.
//================================================================================================//
#define TIMER__DRVTIMESTAMPSYSTICK_C
//================================================================================================//



//================================================================================================//
// V E R I F Y    C O N F I G U R A T I O N
//------------------------------------------------------------------------------------------------//
#include "AppConfig.h"
//------------------------------------------------------------------------------------------------//
// @brief  Defines the log level of the module
#ifndef TIMER__DRVTIMESTAMP_LOG_LEVEL
	#define CORELOG_LEVEL               LOG_LEVEL_DEFAULT
#else
	#define CORELOG_LEVEL               TIMER__DRVTIMESTAMP_LOG_LEVEL
#endif
//================================================================================================//



//================================================================================================//
// I N C L U D E S
//------------------------------------------------------------------------------------------------//
#include "Core.h"
#include "core\ISysTick.h"

//DRV lib include section

//STD lib include section

//COM lib include section

//APP include section
#include "timer\DrvTimeStampSysTick.h"
//================================================================================================//



//================================================================================================//
// L O C A L   D E F I N I T I O N S   A N D   M A C R O S
//------------------------------------------------------------------------------------------------//
//================================================================================================//



//================================================================================================//
// L O C A L   T Y P E D E F S
//------------------------------------------------------------------------------------------------//
//================================================================================================//



//================================================================================================//
// L O C A L   F U N C T I O N   P R O T O T Y P E S
//------------------------------------------------------------------------------------------------//
TIMESTAMP DrvTimeStampSysTick_GetTimeStamp(TIMESTAMP_ID id);
//================================================================================================//



//================================================================================================//
// L O C A L   V A R I A B L E S
//------------------------------------------------------------------------------------------------//
MODULE_DECLARE();
static TIMESTAMP_STRUCT                            timestamp_systick_struct;
static TIMESTAMP_HOOK_LIST                         timestamp_systick_hook_list;
//================================================================================================//



//================================================================================================//
// E X P O R T E D   V A R I A B L E S
//------------------------------------------------------------------------------------------------//
//================================================================================================//



//================================================================================================//
// L O C A L   F U N C T I O N S
//------------------------------------------------------------------------------------------------//
TIMESTAMP DrvTimeStampSysTick_GetTimeStamp(TIMESTAMP_ID id)
{
    return SysTick_GetTickCount() * (0xFFFFFFFF / STRELOAD);
}
//================================================================================================//



//================================================================================================//
// E X P O R T E D   F U N C T I O N S
//------------------------------------------------------------------------------------------------//
void DrvTimeStampSysTick_Init(void)
{
    MODULE_INIT_ONCE();
    //place init code which must only be executed once here
    
    MODULE_INIT_DONE();
    //place init code which must executed on every re-init here
    
    
    timestamp_systick_hook_list.get_timestamp_hook = DrvTimeStampSysTick_GetTimeStamp;
    timestamp_systick_hook_list.setup_hook = NULL;    // changing the systick frequency is NOT ALLOWED THROUGH THIS MODULE, should be done in CoreTask!!
    timestamp_systick_struct.hook_list_ptr = &timestamp_systick_hook_list;
    
    CalculateScaleAndUnit(&timestamp_systick_struct, 1000000/TASK_TICK_IN_US);
    
}
//------------------------------------------------------------------------------------------------//
TIMESTAMP DrvTimeStampSysTick_GetDefaultTimeStamp(void)
{
    return SysTick_GetTickCount() * (0xFFFFFFFF / STRELOAD);
}
//------------------------------------------------------------------------------------------------//
TIMESTAMP_HNDL DrvTimeStampSysTick_GetDefaultHandle(void)
{
    MODULE_CHECK();
    
    return &timestamp_systick_struct;
}
//================================================================================================//
